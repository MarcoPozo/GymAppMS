<%- include('partials/header') %>
<%- include('partials/navbarAdmin') %>

<main class="min-h-screen bg-[var(--color-fondo-principal)] text-[var(--color-texto-principal)] p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">Gestión de Membresías</h1>
    <a href="/admin/membresias/nueva" class="bg-[var(--color-boton-cta)] hover:bg-[var(--color-hover-glow)] text-black font-semibold py-2 px-4 rounded">
      + Nueva Membresía
    </a>
  </div>

  <table class="w-full border-collapse bg-[var(--color-fondo-secundario)] rounded-lg overflow-hidden">
    <thead class="bg-[var(--color-acento-cosmico)] text-white">
      <tr>
        <th class="p-3 text-left">Usuario</th>
        <th class="p-3 text-left">Inicio</th>
        <th class="p-3 text-left">Fin</th>
        <th class="p-3 text-left">Tiempo Restante</th>
        <th class="p-3 text-left">Estado</th>
        <th class="p-3 text-left">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <% membresias.forEach(m => { %>
      <tr class="border-t border-[var(--color-lunar-principal)] hover:bg-gray-800">
        <td class="p-3"><%= m.full_name %> (<%= m.cedula %>)</td>
        <td class="p-3">
          <%= new Date(m.start_date).toLocaleDateString("es-EC", {
            weekday: "long",
            day: "2-digit",
            month: "long",
            year: "numeric"
          }) %>
        </td>

        <td class="p-3">
          <%= new Date(m.end_date).toLocaleDateString("es-EC", {
            weekday: "long",
            day: "2-digit",
            month: "long",
            year: "numeric"
          }) %>
        </td>

        <td class="p-3">
          <!-- <%= new Date(m.end_date).toLocaleDateString("es-EC", {
            weekday: "long",
            day: "2-digit",
            month: "long",
            year: "numeric"
          }) %> -->

          <% 
            const hoy = new Date();
            const vencimiento = new Date(m.end_date);
            const diffTime = vencimiento - hoy;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
          %>
          <p class="text-sm mt-1">
            <% if (diffDays < 0) { %>
            <span class="text-red-400">Venció hace <%= Math.abs(diffDays) %> días</span>
            <% } else if (diffDays === 0) { %>
            <span class="text-yellow-400">Vence hoy</span>
            <% } else { %>
            <span class="text-green-400">Faltan <%= diffDays %> días</span>
            <% } %>
          </p>
        </td>

        <td class="p-3 capitalize"><%= m.status %></td>
        <td class="p-3">
          <form action="/admin/membresias/<%= m.id %>/renovar" method="POST">
            <button class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded">
              Renovar
            </button>
          </form>
        </td>
      </tr>
      <% }) %>
    </tbody>
  </table>
</main>

<%- include('partials/footer') %>